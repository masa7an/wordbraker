# Word Breaker（英単語ブロック崩し）要件定義書

## 1. プロジェクト概要

### 1.1 ゲームタイトル
Word Breaker（英単語ブロック崩し）

### 1.2 開発フェーズ
- **第1フェーズ**: Python + pygame でローカル実装
- **目的**: 完成度の高いゲームロジックの確立
- **制約**: Web実行・ブラウザ対応は行わない（将来pygbagでWeb化予定）

### 1.3 技術スタック
- Python 3.x
- pygame 2.5.2（安定版）
- JSON（英単語データ）

---

## 2. 画面・解像度仕様

### 2.1 基本設定
- **画面サイズ**: 1280×720
- **フルスクリーン**: `pygame.SCALED | pygame.FULLSCREEN` 前提
- **カラースキーム**: ダークモード + 目に優しい柔らかめの色

---

## 3. ゲーム要素のサイズ・物理仕様

### 3.1 要素サイズ
| 要素 | サイズ |
|------|--------|
| ブロック | 100×40 |
| パドル | 140×20 |
| ボール | 半径 8 |
| 扉 | 120×40 |

### 3.2 速度設定
- **ボール初期速度**: (±4, -5) ※x方向はランダム符号
- **パドル速度**: 8
- **ボール落下時**: ライフ-1 → 即リスポーン

### 3.3 反射システム
- **パドル反射**:
  - 速度の大きさは基本維持
  - y方向は常に反転
  - x方向はパドル命中位置で変化
  - パドル中央：ほぼ真上
  - 端に近いほど角度がつく（最大 |vx| = 6）
- **ブロック反射**: 単純な上下反転（角度調整なし）

---

## 4. ゲームルール

### 4.1 コアゲームループ
```
問題表示
↓
3択ブロック配置
↓
ボール発射（クリック待ち）
↓
正解ブロックのみ破壊可能
↓
全正解ブロック破壊
↓
扉解放
↓
扉にヒット → ステージクリア
```

### 4.2 ブロック仕様
| 種類 | 特性 |
|------|------|
| 正解ブロック | 1ヒットで破壊 |
| 不正解ブロック | 完全無敵（音・エフェクトのみ） |
| 装飾ブロック | 背景扱い、当たり判定なし（初期ステージでは未実装） |

### 4.3 ブロック配置
- **配置方法**: 3列固定・中央揃え
- **ブロック間隔**: 横 10px / 縦 10px
- **単語とブロックの関係**: 1単語 = 正解ブロック1個
- **装飾ブロック**: 初期ステージでは配置しない

### 4.4 扉（ゴール）仕様
- **位置**: X = (1280 - 120) / 2 = 580, Y = 20
- **サイズ**: 120×40
- **初期状態**: ロック
- **アンロック条件**: 正解ブロック全破壊
- **当たり判定**: Rect判定（クリア条件成立後のみ有効）
- **クリア条件**: ボールが扉に当たると即クリア

---

## 5. スコア・コンボシステム

### 5.1 得点要素
- **正解ブロック破壊**: +100
- **コンボ倍率**: 3回連続で×1.2（3回ごとに適用）
- **ノーミスボーナス**: ×1.2 + "PERFECT!!"の文字表示

### 5.2 コンボシステム
- **成立条件**: 正解ブロックを連続で破壊
- **コンボ数**: 3回連続で1コンボ
- **効果**: 3回ごとにスコア倍率 ×1.2
- **リセット条件**: 不正解ブロック命中 or ミス（ボール落下）

### 5.3 スコア表示
- **表示位置**: 左上
- **フォントサイズ**: 24px
- **更新方式**: リアルタイム更新

### 5.4 RTA（リアルタイムアタック）
- **計測範囲**: ステージ開始から扉ヒットまで
- **最速記録**: ローカル保存
- **表示**: 右上にタイマー表示

---

## 6. ライフシステム

### 6.1 基本設定
- **初期ライフ**: 10
- **ライフ減少条件**: ボール落下
- **落下時処理**: ライフ-1 → 即リスポーン

### 6.2 ゲームオーバー
- **条件**: ライフが0
- **表示内容**:
  - "GAME OVER"
  - スコア
  - リトライボタン
- **コンティニュー処理**:
  - ライフ全回復
  - 同ステージを最初から
  - スコアは保持

---

## 7. ステージ構造

### 7.1 基本構成
- **1ステージの単語数**: 3〜5語
- **ブロック列**: 3列固定
- **高さ**: 可変

### 7.2 難易度段階（将来拡張用）
| レベル | 特徴 |
|--------|------|
| 初級 | 正解ブロック密集 |
| 中級 | 不正解ブロック増 |
| 上級 | 角度が必要な配置 |

### 7.3 ステージクリア処理
- **クリア後待機時間**: 約1.5秒
- **遷移方法**: 自動で次ステージへ（クリック不要）

---

## 8. 学習効率を担保する設計

### 8.1 再出題制御
- **不正解選択肢に当てた回数を記録**
- **ミスした単語は次ステージで再登場**

### 8.2 新出語制限
- **1ステージ最大5語まで**
- **残りは復習語**

### 8.3 出題頻度制御（概念）
- **重み = ミス回数 × 未正解経過時間**
- ※アルゴリズムは実装時に最適化

---

## 9. UI/UX仕様

### 9.1 画面構成
- **上部**: 問題文
- **中央**: ブロックエリア
- **下部**: パドル
- **右上**: タイマー
- **左上**: スコア

### 9.2 タイトル画面
- ゲームタイトル
- スタートボタン
- 操作方法（左右移動／クリックで発射）

### 9.3 リザルト画面
- スコア
- クリアタイム
- 次のステージ or タイトルへ戻るボタン

### 9.4 演出方針
- **正解**: 派手（音＋光）※第1フェーズでは最小限
- **不正解**: 鈍い音のみ
- **解説**: クリア後に1行だけ

---

## 10. 操作仕様

### 10.1 操作方法
- **パドル移動**: マウス／タッチで移動
- **ボール発射**: ワンクリック（ステージ開始時はクリック待ち）
- **発射角度**: x方向のみランダム符号（±）
- **自動ボール反射**: 操作不要

---

## 11. 状態管理

### 11.1 ゲーム状態
- `TITLE`: タイトル画面
- `STAGE_START`: ステージ開始
- `PLAYING`: プレイ中
- `STAGE_CLEAR`: ステージクリア
- `RESULT`: リザルト画面
- `GAME_OVER`: ゲームオーバー

### 11.2 単語状態
- **未出題**: まだ出題されていない
- **正解済**: 正解した
- **ミスあり**: 再出題対象

---

## 12. データ仕様

### 12.1 英単語データ
- **ファイル形式**: JSON
- **ファイルパス**: `C:\Users\masa7\Cursor\wordbraker\英単語50語.txt`（JSON形式に変換）
- **総単語数**: 50語
- **JSON構造例**:
```json
[
  {
    "id": 1,
    "word": "renew",
    "ja": "更新する",
    "category": "subscription",
    "level": 2,
    "choices": ["更新する", "削除する", "停止する"]
  }
]
```

### 12.2 ローカルスコア保存
- **保存形式**: JSON（将来拡張）
- **保存内容**: 最速記録、ハイスコアなど

---

## 13. 音声仕様（将来用）

### 13.1 音声ファイル
- **パス**: `C:\Users\masa7\Cursor\wordbraker\asset\sound\`
- **ファイル**:
  - `Bounce_sound.wav`: ボール反射音
  - `Correct_sound.wav`: 正解音
  - `CLEAR.wav`: クリア音
- **第1フェーズ**: 音声は不要（ただしパスは準備済み）

---

## 14. MVP範囲

### 14.1 実装範囲
- 1ゲームモード
- 10ステージ
- 単語50語
- ローカルスコア保存

### 14.2 拡張余地（今は実装しない）
- 単語ジャンル切替
- デイリーチャレンジ
- オンラインランキング
- 音声（発音）

---

## 15. 開発方針

### 15.1 優先事項
- **学習制御ロジックを優先**
- **演出は最小限でOK**
- **可読性重視**
- **デバッグしやすい構造**

### 15.2 物理演算
- **リアルさより安定性優先**
- **数値はすべて定数で管理**
- **学習テンポを最優先し、ペナルティは軽め**

### 15.3 コード設計
- **OS依存処理・非対応APIは極力避ける**（将来のWeb化を見据えて）
- **定数はすべて設定ファイルで管理**
- **モジュール分割を意識**

---

## 16. 設計思想

- **正解しか進めない**
- **操作＝思考**
- **失敗は次に活かす**
- **短時間・高密度**

---

## 17. 実装チェックリスト

### 17.1 必須機能
- [ ] タイトル画面
- [ ] ゲームループ
- [ ] ブロック配置システム
- [ ] ボール物理演算
- [ ] パドル操作
- [ ] 正解/不正解判定
- [ ] スコア計算
- [ ] コンボシステム
- [ ] ライフシステム
- [ ] 扉システム
- [ ] ステージクリア判定
- [ ] ゲームオーバー処理
- [ ] リザルト画面
- [ ] 英単語データ読み込み
- [ ] 学習制御ロジック（再出題）

### 17.2 オプション機能
- [ ] 音声再生（第1フェーズでは不要）
- [ ] エフェクト演出（最小限）
- [ ] ローカルスコア保存

---

## 18. 定数一覧（実装用）

### 18.1 画面設定
```python
SCREEN_WIDTH = 1280
SCREEN_HEIGHT = 720
```

### 18.2 ゲーム要素サイズ
```python
BLOCK_WIDTH = 100
BLOCK_HEIGHT = 40
PADDLE_WIDTH = 140
PADDLE_HEIGHT = 20
BALL_RADIUS = 8
DOOR_WIDTH = 120
DOOR_HEIGHT = 40
```

### 18.3 速度設定
```python
BALL_SPEED_X = 4  # ±4
BALL_SPEED_Y = 5  # -5
PADDLE_SPEED = 8
BALL_MAX_VX = 6  # パドル端での最大x速度
```

### 18.4 ブロック配置
```python
BLOCK_COLUMNS = 3
BLOCK_SPACING_X = 10
BLOCK_SPACING_Y = 10
```

### 18.5 扉位置
```python
DOOR_X = (SCREEN_WIDTH - DOOR_WIDTH) // 2  # 580
DOOR_Y = 20
```

### 18.6 スコア設定
```python
SCORE_BLOCK_DESTROY = 100
COMBO_THRESHOLD = 3  # 3回連続でコンボ
COMBO_MULTIPLIER = 1.2
PERFECT_BONUS_MULTIPLIER = 1.2
```

### 18.7 ライフ設定
```python
INITIAL_LIFES = 10
```

### 18.8 ステージ設定
```python
STAGE_CLEAR_DELAY = 1.5  # 秒
WORDS_PER_STAGE_MIN = 3
WORDS_PER_STAGE_MAX = 5
NEW_WORDS_PER_STAGE_MAX = 5
```

### 18.9 フォント設定
```python
FONT_SIZE_SCORE = 24
```

---

## 19. ファイル構成（予定）

```
wordbraker/
├── main.py                 # エントリーポイント
├── config.py               # 定数管理
├── game.py                 # メインゲームループ
├── states/                 # ゲーム状態管理
│   ├── __init__.py
│   ├── title.py
│   ├── playing.py
│   ├── stage_clear.py
│   ├── result.py
│   └── game_over.py
├── entities/               # ゲーム要素
│   ├── __init__.py
│   ├── ball.py
│   ├── paddle.py
│   ├── block.py
│   └── door.py
├── systems/                # システム
│   ├── __init__.py
│   ├── word_manager.py     # 単語管理・学習制御
│   ├── score_manager.py    # スコア管理
│   └── collision.py        # 当たり判定
├── data/
│   └── words.json          # 英単語データ（JSON形式）
├── asset/
│   └── sound/              # 音声ファイル（将来用）
├── requirements.txt
├── README.md
├── 要件定義書.md
└── 設計の下書き.txt
```

---

## 20. 実装時の注意事項

1. **定数はすべてconfig.pyで管理**
2. **物理演算は安定性優先（数値は定数で管理）**
3. **学習制御ロジックを最優先**
4. **可読性・デバッグしやすさを重視**
5. **OS依存処理は避ける**
6. **モジュール分割を意識**
7. **エラーハンドリングを適切に実装**

---

**最終更新日**: 2024年
**バージョン**: 1.0

